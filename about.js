const photocards =
  [
    // FORMULA OF LOVE
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "OT9",
      "img": "/assets/photocards/Formula of Love/fol-pob-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Formula of Love/fol-pob-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Yoo Jeongyeon",
      "img": "/assets/photocards/Formula of Love/fol-pob-02-jeongyeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jeongyeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Hirai Momo",
      "img": "/assets/photocards/Formula of Love/fol-pob-03-momo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/momo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Formula of Love/fol-pob-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Formula of Love/fol-pob-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Myoi Mina",
      "img": "/assets/photocards/Formula of Love/fol-pob-06-mina.jpg",
      "category": "have",
      "pfp": "/assets/pfp/mina.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Formula of Love/fol-pob-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Formula of Love/fol-pob-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Formula of Love/fol-pob-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Hirai Momo",
      "img": "/assets/photocards/Formula of Love/fol-random-03-momo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/momo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Formula of Love/fol-random-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Myoi Mina",
      "img": "/assets/photocards/Formula of Love/fol-random-06-mina.jpg",
      "category": "have",
      "pfp": "/assets/pfp/mina.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Formula of Love/fol-random-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Formula of Love/fol-sc-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Formula of Love/fol-sc-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Formula of Love/fol-scratch-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    // TASTE OF LOVE
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Taste of Love/tol-lenti-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "OT9",
      "img": "/assets/photocards/Taste of Love/tol-pob-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Taste of Love/tol-pob-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Yoo Jeongyeon",
      "img": "/assets/photocards/Taste of Love/tol-pob-02-jeongyeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jeongyeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Hirai Momo",
      "img": "/assets/photocards/Taste of Love/tol-pob-03-momo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/momo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Taste of Love/tol-pob-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Taste of Love/tol-pob-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Myoi Mina",
      "img": "/assets/photocards/Taste of Love/tol-pob-06-mina.jpg",
      "category": "have",
      "pfp": "/assets/pfp/mina.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Taste of Love/tol-pob-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Taste of Love/tol-pob-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Taste of Love/tol-pob-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Taste of Love/tol-random-01-nayeon-2.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Taste of Love/tol-random-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Taste of Love/tol-random-04-sana-2.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Taste of Love/tol-random-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Taste of Love/tol-random-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    // FANCY YOU
    {
      "group": "TWICE",
      "album": "Fancy You",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Fancy You/fy-mono-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    //PAGE TWO
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Page Two/pt-lenti-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Page Two/pt-random-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Page Two/pt-random-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Sub-unit",
      "img": "/assets/photocards/Page Two/pt-unit-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    },
    // THE STORY BEGINS
    {
      "group": "TWICE",
      "album": "The Story Begins",
      "member": "Im Nayeon",
      "img": "/assets/photocards/The Story Begins/tsb-random-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "The Story Begins",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/The Story Begins/tsb-random-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "The Story Begins",
      "member": "Sub-unit",
      "img": "/assets/photocards/The Story Begins/tsb-unit-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    }
    // WANT
    ,
    {
      "group": "Red Velvet",
      "album": "The ReVe Festival: Finale",
      "member": "Kang Seulgi",
      "img": "/assets/photocards/Wishlist/trff-02-seulgi.jpg",
      "category": "want",
      "pfp": "/assets/pfp/seulgi.jpg"
    },
    {
      "group": "Red Velvet",
      "album": "The ReVe Festival: Day 2",
      "member": "Irene",
      "img": "/assets/photocards/Wishlist/trfd2-01-irene.jpg",
      "category": "want",
      "pfp": "/assets/pfp/irene.jpg"
    },
    {
      "group": "TWICE",
      "album": "Twicecoaster: Lane 1",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Wishlist/tcl1-01-nayeon.jpg",
      "category": "want",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Eyes Wide Open",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Wishlist/ewo-08-chaeyoung.jpg",
      "category": "want",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "Professional Boxer",
      "album": "Senator",
      "member": "Manny Pacquiao",
      "img": "/assets/photocards/Wishlist/leaf-pacman.jpg",
      "category": "want",
      "pfp": "/assets/pfp/pacman.jpg"
    },
  ]

let filteredPhotocards = [];
filteredPhotocards = photocards;
const categoryButtons = Array.from(document.querySelectorAll('.btn--category'));
let categoryState = "have";
let searchString = '';

// Handle Category State
function changeCategoryState() {
  if (document.querySelector('.btn--active') !== null) {
    document.querySelector('.btn--active').classList.remove('btn--active');
  }

  this.classList.add('btn--active');
  categoryState = this.value;
  searchString = ''
  searchBar.value = ''
  displayPhotocards();
}

categoryButtons.forEach((button) => button.addEventListener('click', changeCategoryState));

// Handle Search Bar
function handleSearchKeyUp(e) {
  searchString = e.target.value.toLowerCase();
  if (e.key === 'Enter') displayPhotocards();
  if (searchString === '') displayPhotocards();
  if (e.key === 'Escape') { searchBar.value = '' };
}

searchBar.addEventListener('keyup', handleSearchKeyUp);
searchBar.addEventListener('focusout', displayPhotocards);
let generatedPhotocardList;

// Handle Filter
function filterByCategory(photocard) {
  return photocard.category === categoryState;
};

function filterBySearch(photocard) {
  return photocard.member.toLowerCase().includes(searchString) || photocard.group.toLowerCase().includes(searchString);
};


function displayPhotocards() {
  photocardsContainer.innerHTML = "";

  filteredPhotocards = photocards.filter(filterByCategory).filter(filterBySearch);

  if (filteredPhotocards.length == 0) {
    photocardsContainer.innerHTML = `
        <div class="empty-container">
            <div>
                <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path id="#skin" d="M32.0552 59.1782C47.0249 59.1782 59.1602 47.0429 59.1602 32.0732C59.1602 17.1035 47.0249 4.96814 32.0552 4.96814C17.0855 4.96814 4.9502 17.1035 4.9502 32.0732C4.9502 47.0429 17.0855 59.1782 32.0552 59.1782Z" fill="#FBCABF" />
                    <g id="blush">
                        <path id="#right-blush" d="M16.8939 54.796C22.956 54.796 27.8704 49.8817 27.8704 43.8196C27.8704 37.7575 22.956 32.8431 16.8939 32.8431C10.8318 32.8431 5.91748 37.7575 5.91748 43.8196C5.91748 49.8817 10.8318 54.796 16.8939 54.796Z" fill="#E88A9F" />
                        <path id="#left-blush" d="M48.1239 54.796C54.186 54.796 59.1003 49.8817 59.1003 43.8196C59.1003 37.7575 54.186 32.8431 48.1239 32.8431C42.0618 32.8431 37.1475 37.7575 37.1475 43.8196C37.1475 49.8817 42.0618 54.796 48.1239 54.796Z" fill="#E88A9F" />
                    </g>
                    <path d="M26.7057 43.3278C26.7685 40.4244 29.0772 38.0047 32.0288 38.0047C34.9804 38.0047 37.289 40.4244 37.3533 43.3278C37.384 44.7977 39.6708 44.8021 39.6386 43.3278C39.551 39.1839 36.237 35.7296 32.0288 35.7179C27.8206 35.7062 24.508 39.1985 24.4204 43.3278C24.3882 44.8007 26.675 44.7992 26.7057 43.3278Z" fill="#231F20" />
                    <g id="right-eye">
                        <path id="Vector_2" d="M42.5856 32.3931C44.5991 32.3931 46.2313 30.7609 46.2313 28.7475C46.2313 26.734 44.5991 25.1018 42.5856 25.1018C40.5722 25.1018 38.9399 26.734 38.9399 28.7475C38.9399 30.7609 40.5722 32.3931 42.5856 32.3931Z" fill="#231F20" />
                        <path id="Vector_3" d="M41.0034 29.6665C41.8773 29.6665 42.5858 28.958 42.5858 28.0841C42.5858 27.2101 41.8773 26.5016 41.0034 26.5016C40.1294 26.5016 39.4209 27.2101 39.4209 28.0841C39.4209 28.958 40.1294 29.6665 41.0034 29.6665Z" fill="#FDFEFE" />
                    </g>
                    <g id="left-eye">
                        <path id="Vector_4" d="M22.9328 32.3931C24.9462 32.3931 26.5784 30.7609 26.5784 28.7475C26.5784 26.734 24.9462 25.1018 22.9328 25.1018C20.9193 25.1018 19.2871 26.734 19.2871 28.7475C19.2871 30.7609 20.9193 32.3931 22.9328 32.3931Z" fill="#231F20" />
                        <path id="Vector_5" d="M21.6147 29.5029C22.4887 29.5029 23.1972 28.7944 23.1972 27.9205C23.1972 27.0465 22.4887 26.338 21.6147 26.338C20.7407 26.338 20.0322 27.0465 20.0322 27.9205C20.0322 28.7944 20.7407 29.5029 21.6147 29.5029Z" fill="#FDFEFE" />
                    </g>
                    <path id="hair" class="rotate--svg" fill-rule="evenodd" clip-rule="evenodd" d="M63.9376 32.0141C63.9376 49.6267 49.6597 63.9045 32.0472 63.9045C14.4346 63.9045 0.156738 49.6267 0.156738 32.0141C0.156738 14.4015 14.4346 0.123657 32.0472 0.123657C49.6597 0.123657 63.9376 14.4015 63.9376 32.0141ZM24.0825 53.828C21.9733 50.3014 18.4238 47.7355 14.2466 46.9425C14.1832 42.8338 12.3922 38.8369 9.17107 36.0616C11.1705 32.4716 11.618 28.1147 10.216 24.1006C13.7426 21.9914 16.3085 18.4419 17.1014 14.2646C21.2102 14.2012 25.2071 12.4103 27.9824 9.18909C31.5723 11.1886 35.9293 11.6361 39.9434 10.2341C42.0526 13.7607 45.6021 16.3266 49.7793 17.1195C49.8427 21.2282 51.6337 25.2252 54.8548 28.0005C52.8554 31.5904 52.4079 35.9474 53.8099 39.9614C50.2833 42.0707 47.7174 45.6202 46.9245 49.7974C42.8158 49.8608 38.8188 51.6518 36.0435 54.873C32.4536 52.8735 28.0966 52.426 24.0825 53.828Z" fill="#231F20" />
                </svg>
                <h3 class="text-lg">Seems like I don't have that photocard :(</h3>
                <p class="text-md">You can always buy me some though.</p>
            </div>
        </div>
    `
  } else {
    const photocardsList = document.createElement('div');
    photocardsList.classList.add('photocards-list');
    photocardsContainer.appendChild(photocardsList);
    const htmlString = filteredPhotocards.map(photocard => `<img src="${photocard.img}" alt="${photocard.group} - ${photocard.member}" data-member="${photocard.member}" data-group="${photocard.group}" data-album="${photocard.album}" data-pfp="${photocard.pfp}" class="photocard" tabindex="0">`).join("");
    photocardsList.innerHTML = htmlString;
    generatedPhotocardList = document.querySelector('.photocards-list');
    Gallery(generatedPhotocardList);
  }
};

displayPhotocards();

const body = document.querySelector('body')

Gallery
function Gallery(gallery) {
  if (!gallery) {
    throw new Error('No Gallery Found!');
  }

  const images = Array.from(gallery.querySelectorAll('img'));
  let modal = document.querySelector('.modal');
  const prevButton = modal.querySelector('.prev');
  const nextButton = modal.querySelector('.next');
  const trapFocus = document.querySelector(".trapfocus")
  let previousActiveElement;
  let currentImage;

  function openModal() {
    console.info('Opening Modal...');
    body.style.overflow = "hidden";

    if (modal.matches('.open')) {
      console.info('Modal already open');
      return;
    }
    modal.classList.add('open');
    previousActiveElement = document.activeElement;
    trapFocusModal(trapFocus);
    nextButton.focus();
    window.addEventListener('keyup', handleKeyUp);
    nextButton.addEventListener('click', showNextImage);
    prevButton.addEventListener('click', showPrevImage);
  }

  function closeModal() {
    modal.classList.remove('open');
    previousActiveElement.focus();
    window.removeEventListener('keyup', handleKeyUp);
    nextButton.removeEventListener('click', showNextImage);
    prevButton.removeEventListener('click', showPrevImage);
    body.style.overflow = "auto";
  }

  function handleClickOutside(e) {
    if (e.target === e.currentTarget) {
      closeModal();
    }
  }

  function handleKeyUp(event) {
    if (event.key === 'Escape') return closeModal();
    if (event.key === 'ArrowRight') return showNextImage();
    if (event.key === 'ArrowLeft') return showPrevImage();
  }

  function showNextImage() {
    showImage(currentImage.nextElementSibling || gallery.firstElementChild);
  }
  function showPrevImage() {
    showImage(currentImage.previousElementSibling || gallery.lastElementChild);
  }

  function showImage(el) {
    if (!el) {
      return;
    }
    modal.querySelector('.modalInner__image img').src = el.src;
    modal.querySelector('.modalInner__details img').src = el.dataset.pfp;
    modal.querySelector('h2').textContent = el.dataset.member;
    modal.querySelector('p').textContent = `${el.dataset.group} · ${el.dataset.album}`;
    currentImage = el;

    openModal();
  }

  // These are our Event Listeners!
  images.forEach(image =>
    image.addEventListener('click', e => showImage(e.currentTarget))
  );

  images.forEach(image => {
    image.addEventListener('keyup', e => {
      if (e.key === 'Enter') {
        showImage(e.currentTarget);
      }
    });
  });

  modal.addEventListener('click', handleClickOutside);
}


// Trap Focus on Modal
const focusableElements = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';

function trapFocusModal(modal) {
  const focusableContent = modal.querySelectorAll(focusableElements);
  const firstFocusableElement = modal.querySelectorAll(focusableElements)[0];
  const lastFocusableElement = focusableContent[focusableContent.length - 1];

  document.addEventListener('keydown', function (e) {
    let isTabPressed = e.key === 'Tab' || e.keyCode === 9;

    if (!isTabPressed) {
      return;
    }

    if (e.shiftKey) { // if shift key pressed for shift + tab combination
      if (document.activeElement === firstFocusableElement) {
        lastFocusableElement.focus(); // add focus for the last focusable element
        e.preventDefault();
      }
    } else { // if tab key is pressed
      if (document.activeElement === lastFocusableElement) { // if focused has reached to last focusable element then focus first focusable element after pressing tab
        firstFocusableElement.focus(); // add focus for the first focusable element
        e.preventDefault();
      }
    }
  });
}
