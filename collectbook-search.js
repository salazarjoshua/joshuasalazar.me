const photocards =
  [
    // FORMULA OF LOVE
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "OT9",
      "img": "/assets/photocards/Formula of Love/fol-pob-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Formula of Love/fol-pob-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Yoo Jeongyeon",
      "img": "/assets/photocards/Formula of Love/fol-pob-02-jeongyeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jeongyeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Hirai Momo",
      "img": "/assets/photocards/Formula of Love/fol-pob-03-momo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/momo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Formula of Love/fol-pob-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Formula of Love/fol-pob-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Myoi Mina",
      "img": "/assets/photocards/Formula of Love/fol-pob-06-mina.jpg",
      "category": "have",
      "pfp": "/assets/pfp/mina.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Formula of Love/fol-pob-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Formula of Love/fol-pob-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Formula of Love/fol-pob-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Hirai Momo",
      "img": "/assets/photocards/Formula of Love/fol-random-03-momo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/momo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Formula of Love/fol-random-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Myoi Mina",
      "img": "/assets/photocards/Formula of Love/fol-random-06-mina.jpg",
      "category": "have",
      "pfp": "/assets/pfp/mina.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Formula of Love/fol-random-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Formula of Love/fol-sc-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Formula of Love/fol-sc-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Formula of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Formula of Love/fol-scratch-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    // TASTE OF LOVE
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Taste of Love/tol-lenti-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "OT9",
      "img": "/assets/photocards/Taste of Love/tol-pob-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Taste of Love/tol-pob-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Yoo Jeongyeon",
      "img": "/assets/photocards/Taste of Love/tol-pob-02-jeongyeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jeongyeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Hirai Momo",
      "img": "/assets/photocards/Taste of Love/tol-pob-03-momo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/momo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Taste of Love/tol-pob-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Taste of Love/tol-pob-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Myoi Mina",
      "img": "/assets/photocards/Taste of Love/tol-pob-06-mina.jpg",
      "category": "have",
      "pfp": "/assets/pfp/mina.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Taste of Love/tol-pob-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Taste of Love/tol-pob-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/Taste of Love/tol-pob-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Taste of Love/tol-random-01-nayeon-2.jpg",
      "category": "have",
      "pfp": "/assets/pfp/2.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Taste of Love/tol-random-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Taste of Love/tol-random-04-sana-2.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Minatozaki Sana",
      "img": "/assets/photocards/Taste of Love/tol-random-04-sana.jpg",
      "category": "have",
      "pfp": "/assets/pfp/sana.jpg"
    },
    {
      "group": "TWICE",
      "album": "Taste of Love",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Taste of Love/tol-random-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    // FANCY YOU
    {
      "group": "TWICE",
      "album": "Fancy You",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Fancy You/fy-mono-08-chaeyoung.jpg",
      "category": "have",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    //PAGE TWO
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Page Two/pt-lenti-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Park Jihyo",
      "img": "/assets/photocards/Page Two/pt-random-05-jihyo.jpg",
      "category": "have",
      "pfp": "/assets/pfp/jihyo.jpg"
    },
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Kim Dahyun",
      "img": "/assets/photocards/Page Two/pt-random-07-dahyun.jpg",
      "category": "have",
      "pfp": "/assets/pfp/dahyun.jpg"
    },
    {
      "group": "TWICE",
      "album": "Page Two",
      "member": "Sub-unit",
      "img": "/assets/photocards/Page Two/pt-unit-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    },
    // THE STORY BEGINS
    {
      "group": "TWICE",
      "album": "The Story Begins",
      "member": "Im Nayeon",
      "img": "/assets/photocards/The Story Begins/tsb-random-01-nayeon.jpg",
      "category": "have",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "The Story Begins",
      "member": "Chou Tzuyu",
      "img": "/assets/photocards/The Story Begins/tsb-random-09-tzuyu.jpg",
      "category": "have",
      "pfp": "/assets/pfp/tzuyu.jpg"
    },
    {
      "group": "TWICE",
      "album": "The Story Begins",
      "member": "Sub-unit",
      "img": "/assets/photocards/The Story Begins/tsb-unit-00-twice.jpg",
      "category": "have",
      "pfp": "/assets/pfp/twice.jpg"
    }
    // WANT
    ,
    {
      "group": "Red Velvet",
      "album": "The ReVe Festival: Finale",
      "member": "Kang Seulgi",
      "img": "/assets/photocards/Wishlist/trff-02-seulgi.jpg",
      "category": "want",
      "pfp": "/assets/pfp/seulgi.jpg"
    },
    {
      "group": "Red Velvet",
      "album": "The ReVe Festival: Day 2",
      "member": "Irene",
      "img": "/assets/photocards/Wishlist/trfd2-01-irene.jpg",
      "category": "want",
      "pfp": "/assets/pfp/irene.jpg"
    },
    {
      "group": "TWICE",
      "album": "Twicecoaster: Lane 1",
      "member": "Im Nayeon",
      "img": "/assets/photocards/Wishlist/tcl1-01-nayeon.jpg",
      "category": "want",
      "pfp": "/assets/pfp/nayeon.jpg"
    },
    {
      "group": "TWICE",
      "album": "Eyes Wide Open",
      "member": "Son Chaeyoung",
      "img": "/assets/photocards/Wishlist/ewo-08-chaeyoung.jpg",
      "category": "want",
      "pfp": "/assets/pfp/chaeyoung.jpg"
    },
    {
      "group": "Professional Boxer",
      "album": "Senator",
      "member": "Manny Pacquiao",
      "img": "/assets/photocards/Wishlist/leaf-pacman.jpg",
      "category": "want",
      "pfp": "/assets/pfp/pacman.jpg"
    },
  ]

let filteredPhotocards = [];
filteredPhotocards = photocards;
const categoryButtons = Array.from(document.querySelectorAll('.btn--category'));
let categoryState = "have";
let searchString = '';

// Handle Category State
function changeCategoryState() {
  if (document.querySelector('.btn--active') !== null) {
    document.querySelector('.btn--active').classList.remove('btn--active');
  }

  this.classList.add('btn--active');
  categoryState = this.value;
  searchString = ''
  searchBar.value = ''
  displayPhotocards();
}

categoryButtons.forEach((button) => button.addEventListener('click', changeCategoryState));

// Handle Search Bar
function handleSearchKeyUp(e) {
  searchString = e.target.value.toLowerCase();
  if (e.key === 'Enter') { displayPhotocards(); searchBar.blur(); };
  if (searchString === '') displayPhotocards();
  if (e.key === 'Escape') { searchBar.value = '' };
}

searchBar.addEventListener('keyup', handleSearchKeyUp);
let generatedPhotocardList;

// Handle Filter
function filterByCategory(photocard) {
  return photocard.category === categoryState;
};

function filterBySearch(photocard) {
  return photocard.member.toLowerCase().includes(searchString) || photocard.group.toLowerCase().includes(searchString);
};


function displayPhotocards() {
  photocardsContainer.innerHTML = "";

  filteredPhotocards = photocards.filter(filterByCategory).filter(filterBySearch);

  if (filteredPhotocards.length == 0) {
    photocardsContainer.innerHTML = `
    <div class="empty-container">
      <div>
          <img src="/assets/avatar-sad.svg" alt="sad face">
          <h3 class="text-lg">Seems like I don’t have that photocard :(</h3>
          <p class="text-md">You can always buy me one though.</p>
      </div>
    </div>
    `
  } else {
    const photocardsList = document.createElement('div');
    photocardsList.classList.add('photocards-list');
    photocardsContainer.appendChild(photocardsList);
    const htmlString = filteredPhotocards.map(photocard => `<img src="${photocard.img}" alt="${photocard.group} - ${photocard.member}" data-member="${photocard.member}" data-group="${photocard.group}" data-album="${photocard.album}" data-pfp="${photocard.pfp}" class="photocard" tabindex="0">`).join("");
    photocardsList.innerHTML = htmlString;
    generatedPhotocardList = document.querySelector('.photocards-list');
    Gallery(generatedPhotocardList);
  }
};

displayPhotocards();

const body = document.querySelector('body')

Gallery
function Gallery(gallery) {
  if (!gallery) {
    throw new Error('No Gallery Found!');
  }

  const images = Array.from(gallery.querySelectorAll('img'));
  let modal = document.querySelector('.modal');
  const prevButton = modal.querySelector('.prev');
  const nextButton = modal.querySelector('.next');
  const trapFocus = document.querySelector(".trapfocus")
  let previousActiveElement;
  let currentImage;

  function openModal() {
    console.info('Opening Modal...');
    body.style.overflow = "hidden";

    if (modal.matches('.open')) {
      console.info('Modal already open');
      return;
    }
    modal.classList.add('open');
    previousActiveElement = document.activeElement;
    trapFocusModal(trapFocus);
    nextButton.focus();
    window.addEventListener('keyup', handleKeyUp);
    nextButton.addEventListener('click', showNextImage);
    prevButton.addEventListener('click', showPrevImage);
  }

  function closeModal() {
    modal.classList.remove('open');
    previousActiveElement.focus();
    window.removeEventListener('keyup', handleKeyUp);
    nextButton.removeEventListener('click', showNextImage);
    prevButton.removeEventListener('click', showPrevImage);
    body.style.overflow = "auto";
  }

  function handleClickOutside(e) {
    if (e.target === e.currentTarget) {
      closeModal();
    }
  }

  function handleKeyUp(event) {
    if (event.key === 'Escape') return closeModal();
    if (event.key === 'ArrowRight') return showNextImage();
    if (event.key === 'ArrowLeft') return showPrevImage();
  }

  function showNextImage() {
    showImage(currentImage.nextElementSibling || gallery.firstElementChild);
  }
  function showPrevImage() {
    showImage(currentImage.previousElementSibling || gallery.lastElementChild);
  }

  function showImage(el) {
    if (!el) {
      return;
    }
    modal.querySelector('.modalInner__image img').src = el.src;
    modal.querySelector('.modalInner__details img').src = el.dataset.pfp;
    modal.querySelector('h2').textContent = el.dataset.member;
    modal.querySelector('p').textContent = `${el.dataset.group} · ${el.dataset.album}`;
    currentImage = el;

    openModal();
  }

  // These are our Event Listeners!
  images.forEach(image =>
    image.addEventListener('click', e => showImage(e.currentTarget))
  );

  images.forEach(image => {
    image.addEventListener('keyup', e => {
      if (e.key === 'Enter') {
        showImage(e.currentTarget);
      }
    });
  });

  modal.addEventListener('click', handleClickOutside);
}


// Trap Focus on Modal
const focusableElements = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';

function trapFocusModal(modal) {
  const focusableContent = modal.querySelectorAll(focusableElements);
  const firstFocusableElement = modal.querySelectorAll(focusableElements)[0];
  const lastFocusableElement = focusableContent[focusableContent.length - 1];

  document.addEventListener('keydown', function (e) {
    let isTabPressed = e.key === 'Tab' || e.keyCode === 9;

    if (!isTabPressed) {
      return;
    }

    if (e.shiftKey) { // if shift key pressed for shift + tab combination
      if (document.activeElement === firstFocusableElement) {
        lastFocusableElement.focus(); // add focus for the last focusable element
        e.preventDefault();
      }
    } else { // if tab key is pressed
      if (document.activeElement === lastFocusableElement) { // if focused has reached to last focusable element then focus first focusable element after pressing tab
        firstFocusableElement.focus(); // add focus for the first focusable element
        e.preventDefault();
      }
    }
  });
}
